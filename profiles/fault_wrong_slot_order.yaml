schema_version: 1
name: fault_wrong_slot_order
description: >-
  Vulnerable OTA that updates the active-slot metadata pointer before the
  new image is fully written to the staging slot. If power is lost after
  the metadata flip but before the copy completes, the bootloader tries to
  boot from a partially-written slot. The correct order is: write image,
  validate image, then atomically update metadata. Uses the vulnerable
  firmware which has no metadata ordering at all.

platform: platforms/cortex_m0_nvm.repl
bootloader:
  elf: examples/vulnerable_ota/firmware.elf
  entry: 0x10000000

memory:
  sram: { start: 0x20000000, end: 0x20020000 }
  write_granularity: 8
  slots:
    exec:    { base: 0x10000000, size: 0x38000 }
    staging: { base: 0x10038000, size: 0x38000 }

images:
  staging: examples/vulnerable_ota/firmware.bin


success_criteria:
  vtor_in_slot: exec

fault_sweep:
  mode: runtime
  max_writes: 28672
  max_writes_cap: 100000
  run_duration: "0.01"

expect:
  should_find_issues: true
  brick_rate_min: 0.5
